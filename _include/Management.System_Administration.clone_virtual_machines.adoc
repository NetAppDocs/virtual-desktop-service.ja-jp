= 概要
:allow-uri-read: 




== 概要

Virtual Desktop Service （ VDS ；仮想デスクトップサービス）では、既存の仮想マシン（ VM ）をクローニングできます。この機能は、定義されたユーザー数の増加に応じてサーバーユニット数の可用性を自動的に向上させるように設計されています。また、使用可能なリソースプールに追加のサーバーを追加

管理者は次の 2 つの方法で VDS のクローニングを使用します。

. 必要に応じて、既存のクライアントサーバから新しいサーバを自動的に作成します
. パートナーが定義および管理するルールに基づいてリソースを自動拡張するための新しいクライアントサーバの事前自動作成




== クローニングして共有サーバを追加する

クローンは、既存の仮想マシンのコピーです。クローニング機能は、ゲストオペレーティングシステムとアプリケーションのインストールに時間がかかるため、時間を節約し、管理者の規模を拡大するのに役立ちます。クローンを使用すると、仮想マシンのコピーを 1 つのインストールおよび設定プロセスから作成できます。通常は次のようになります。

. 必要なすべてのアプリケーションと設定を TS または TSD サーバにインストールする
. [ ワークスペース ]>[ サーバー ] セクション >[ ソースサーバーの歯車アイコン ]>[ クローン ] の順に選択します
. クローンプロセスの実行を許可する（通常は 45 ~ 90 分）
. 最後の手順では、クローンサーバをアクティブにして、 RDS プールに配置し、新しい接続を受け入れます。クローン作成されたサーバでは ' クローン作成後に個別の設定が必要になる場合があるため 'VDS は管理者が手動でサーバをローテーションするのを待機します


必要な回数だけ繰り返します。image:Cloning-Servers.gif[""]

.共有セッションホスト環境でユーザの容量を増やすには、セッションホストのクローニングは簡単なプロセスであり、いくつかの手順を踏むだけで済みます。
. クローニングするセッションホストを選択し、マシンに現在ログインしているユーザがないことを確認します。
. VDS で、ターゲットクライアントのワークスペースに移動します。[Servers] セクションまでスクロールし、歯車アイコンをクリックして [Clone] を選択します。この処理にはかなりの時間がかかり、ソースマシンがオフラインになります。完了までに 30 分以上かかります。
+
image:clone1.png[""]
image:clone2.png[""]

. このプロセスでは、サーバをシャットダウンし、サーバを別のイメージに複製し、お客様の次の TS# にイメージを Sysprep します。サーバーのリストに、「 _Type=Staged _ and _Status=Activation Required_ 」と表示されます。
+
image:clone3.png[""]

. サーバにログオンし、サーバが本番稼働可能な状態になっていることを確認します。
+
image:clone4.png[""]

. 準備ができたら、 [Activate] をクリックしてサーバをセッションホストプールに追加し、ユーザ接続の受け入れを開始します。
+
image:clone5.png[""]





== VDS クローニングプロセスの定義

ステップバイステップのプロセスの詳細については ' クローンサーバの操作の VDS>Deployment>Task History を参照してくださいこのプロセスには 20 以上の手順があります。最初にハイパーバイザーにアクセスしてクローンプロセスを開始し、最後にクローンサーバをアクティブ化します。クローニングプロセスは、次のような重要な手順で構成されます。

* DNS を設定し、サーバ名を設定します
* StaticIP を割り当てます
* ドメインに追加します
* Active Directory を更新します
* VDS DB の更新（ CWMGR1 上の SQL インスタンス）
* クローン用のファイアウォールルールを作成します


タスク履歴だけでなく、すべてのクローニングプロセスの詳細な手順は、各パートナーの Virtual Desktop Deployment の CWMGR1 の CwVmAutomationService ログに表示できます。これらのログファイルの確認については、文書化しています link:Troubleshooting.reviewing_vds_logs.html["こちらをご覧ください"]。



== 新しいサーバの自動作成

この VDS 機能は、定義されたユーザー数の増加に応じてサーバーユニット数の可用性を自動的に向上させるように設計されています。

パートナーは VDS （link:https://manage.cloudworkspace.com[""]） > Client > Overview – VM Resources > Auto-Scalingパートナーが自動スケーリングを有効 / 無効にしたり、クライアントごとにカスタムルールを作成したりできるように、いくつかのコントロールが公開されています。たとえば、ユーザー数 / サーバー数、ユーザーあたりの RAM 容量、 CPU あたりのユーザー数などです。


NOTE: 上記では、仮想デスクトップ環境全体で自動クローン作成が有効になっていることを前提としています。たとえば、すべての自動クローン作成を停止するには、 Advanced （詳細）ウィンドウで、 Server Creation （サーバーの作成） -> Automated Cloning Enabled （自動クローン作成有効）のチェックを外します。



=== 自動クローンプロセスはいつ実行されますか。

自動クローンプロセスは、毎日のメンテナンスの実行が設定されているときに実行されます。デフォルトは午前 0 時ですが、編集可能です。日々のメンテナンスの一環として、各リソースプールに対してリソースの変更スレッドを実行します。Change Resources スレッドは、プールの構成を使用するユーザーの数に基づいて、必要な共有サーバーの数を決定します（カスタマイズ可能。サーバごとに 10 、 21 、 30 などのユーザーを指定できます）。



== 新しいサーバの「オンデマンド」自動作成

この VDS 機能を使用すると、使用可能なリソースプールに追加サーバを自動的に「オンデマンド」でクローニングできます。

VDS 管理者が VDS にログインし、組織またはワークスペースモジュールの下で特定のクライアントを検索し、概要タブを開きます。Servers Tile には、すべてのサーバ（ TSD1 、 TS1 、 D1 など）が一覧表示されます。個々のサーバのクローンを作成するには、サーバ名の右端にある歯車をクリックし、 [ クローン ] オプションを選択します。

通常、このプロセスには約 1 時間かかります。ただし、期間は VM のサイズと、基盤となるハイパーバイザーで使用可能なリソースによって異なります。複製されるサーバは再起動が必要になるため、通常は営業時間外またはスケジュールされた保守期間中に実行します。

TSData サーバーのクローンを作成する場合、重複するファイルがないように、 c:\Home 、 c:\Data 、 c:\Pro の各フォルダを削除します。この場合、クローニングプロセスは失敗します。これらのファイルの削除に問題がありました。このエラーはあいまいです。通常は、ファイルまたはプロセスが開いているためにクローニングイベントが失敗したことを意味します。次に、すべての AV を無効にしてください（このエラーを説明する可能性があるため）。
