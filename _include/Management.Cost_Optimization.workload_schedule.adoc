= ワークロードのスケジュール設定
:allow-uri-read: 




== ワークロードのスケジュール設定

ワークロードのスケジューリングは、環境がアクティブな時間帯をスケジュールできる機能です。

ワークロードのスケジュール設定は、「常時オン」、「常時オフ」、「スケジュール済み」のいずれかに設定できます。「 Scheduled 」に設定すると、曜日ごとに異なる時間枠として、オンおよびオフの時間帯を細かく設定できます。

image:Workload_schedule1.png[""]

「 Always Off 」または「 Scheduled 」により、オフにスケジュールされている場合は、すべてのテナント仮想マシンがシャットダウンされます。プラットフォームサーバ（ CWMGR1 など）は、 Wake on Demand などの機能を容易にするためにアクティブなままになります。

ワークロードスケジュールは、ライブスケーリングや Wake on Demand など、他のリソース最適化機能と連携して機能します。



== オンデマンドでウェイクアップ

Wake on Demand （ WoD ）は特許出願中の技術で、リソースが非アクティブになる予定であっても、 24 時間 365 日の無人アクセスを容易にするために、エンドユーザーに適切な VM リソースをウェイクアップできます。



=== リモートデスクトップサービスの WoD

RDS では、 VDS Windows クライアントに Wake on Demand の統合機能が組み込まれており、エンドユーザーの操作を追加することなく適切なリソースをウェイクアップできます。通常のログインを開始するだけで、クライアントは、 VM がアクティブ化されるまでの短い遅延時間を通知します。このクライアント（およびこの自動ウェイクオンデマンド機能）は、 Windows デバイスから RDS 環境に接続している場合にのみ使用できます。

RDS 展開用の VDS Web クライアントにも同様の機能が組み込まれています。VDS Web Client の場所は次のとおりです。 link:https://login.cloudworkspace.com[""]

Wake on Demand 機能は、 Microsoft RD クライアント（ Windows またはその他のプラットフォーム用）およびサードパーティの RD クライアントには組み込まれていません。



=== Azure Virtual Desktop の Wake on Demand をオンデマンドで実行します

AVD では、接続に使用できる唯一のクライアントが Microsoft から提供されるため、 Wake on Demand 機能は含まれません。

VDS には、 VDS Web Client を介した AVD のセルフサービス Wake On Demand 機能が含まれています。Web クライアントを使用して適切なリソースをウェイクアップでき、標準の AVD クライアントを介して接続を開始できます。

.AVD で VM リソースをウェイクアップするには、次の手順を
. VDS Web Client に接続します link:https://login.cloudworkspace.com[""]
. ユーザ AVD クレデンシャルを使用してログインします
+
** 「 Microsoft の AVD サービスが利用可能です」という警告メッセージが表示されます。ステータスを表示してオフラインのホストプールを開始するには、ここをクリックしてください。 " _


. 「 _here_」 をクリックすると、使用可能なホスト・プールのリストと、ステータス・カラムの下にある「クリックして開始」リンクへのリンクが表示されます
+
image:Wake_on_Demand_h5_1.png[""]

. [ 開始 ] をクリックしてリンクを開き ' ステータスが [ オンライン ] に変わるまで 1 ～ 5 分間待ち ' 緑色のステータスアイコンを表示します
. 通常のプロセスを使用して AVD に接続します




== ライブスケーリング

ライブスケーリングは、ワークロードスケジューリングで設定されたアクティブ時間中にオンラインセッションホストの数を管理することによって、ワークロードスケジューリングと連動します。オフラインにスケジュールされている場合、ライブスケーリングはセッションホストの可用性を制御しません。ライブスケーリングは、 RDS および AVD 環境の共有ユーザーと共有サーバーにのみ影響し、 VDI ユーザーと VDI VM はこれらの計算から除外されます。他のすべての VM タイプには影響はありません。


NOTE: AVD_LOAD balancer TYPE_Setting はこのコンフィギュレーションと相互作用するため ' この設定を選択する際にも注意が必要ですエンドユーザーのパフォーマンスは幅広い第一タイプで最大化されますが、コスト削減は深さ優先タイプで最大化されます。

オプションを選択せずにライブスケーリングを有効にすると、自動化エンジンは、追加電源オンサーバー数、サーバーごとの共有ユーザー数、サーバーごとの最大共有ユーザー数の値を自動的に選択します。

* Extra Powered On Servers_defaults の _ 番号は 0 です。つまり、 1 台のサーバが 24 時間稼働します。
* サーバごとの共有ユーザ _ デフォルトは、企業内のユーザ数をサーバ数で割った値です。
* _ サーバあたりの最大共有ユーザ数 _ デフォルトは無限です。


ライブスケーリングユーザーがログオンするとサーバーがオンになり、ユーザーがログオフするとオフになります。

アクティブなユーザーの総数がサーバーあたりの共有ユーザー数に電源オンサーバーの総数を掛けた数に達すると、追加のサーバーの電源投入が自動的に開始されます。

 e.g. With 5 Shared Users per Server set (this is the default # we’ll use for all examples in this article) and 2 servers running, a 3rd server won’t be powered up until server 1 & 2 both have 5 or more active users. Until that 3rd server is available, new connections will be load balanced all available servers. In RDS and AVD Breadth mode, Load balancing sends users to the server with the fewest active users (like water flowing to the lowest point). In AVD Depth mode, Load balancing sends users to servers in a sequential order, incrementing when the Max Shared Users number is reached.
ライブスケーリングでは、サーバーをオフにしてコストを節約することもできます。サーバにアクティブなユーザが 0 人あり、別のサーバに使用可能な容量がサーバあたり _ 共有ユーザ _ 以下の場合は、空のサーバの電源がオフになります。

次のサーバの電源を入れるには数分かかることがあります。状況によっては、新しいサーバの可用性よりもログインの速度が速くなることがあります。たとえば、 5 分以内に 15 人のユーザーがログインすると、 2 回目と 3 回目の電源投入時に、最初のサーバーにすべてのユーザーが配置されます ( またはセッションが拒否されます ) 。このシナリオでは、 1 つのサーバの過負荷を軽減するために使用できる 2 つの戦略があります。

. 追加のサーバがオンになり、接続を受け入れることができるようになり、プラットフォームが追加のサーバをスピンアップする時間を確保できるようにするための、有効な予備電源オンサーバの数 _ 。
+
.. 有効にすると、計算されたニーズに番号が追加されます。たとえば、 1 台の追加サーバ（および 6 台のユーザが接続されているサーバ）に設定すると、ユーザ数のために 2 台のサーバがアクティブになり、もう 1 台は _Extra Powered On Servers_Setting のためにアクティブになります。


. サーバあたりの共有ユーザの最大数を有効にする _ サーバあたりの許可ユーザ数にハードリミットを設定する。この制限を超える新しい接続は拒否されます。エンドユーザにはエラーメッセージが表示され、追加のサーバが使用可能になってから数分後に再試行する必要があります。この値を設定すると、 AVD 共有サーバの深さも定義されます。
+
.. サーバごとの _Shared Users と _Max Shared Users のデルタが適切であると仮定すると、最も極端な状況（ログインストームが異常に大きい場合）を除くすべての状況で、最大値に達する前に新しいサーバが使用可能になるはずです。






== VM リソースの拡張

VM リソースの拡張は、環境内のセッションホスト VM のサイズと数を変更できるオプションの機能です。

VDS を有効にすると、選択した条件に基づいて、ホスト VM の適切なサイズと数が計算されます。これらのオプションには、 Active Users 、 Named Users 、 Server Load 、 Fixed があります。

image:VMResource2.png[""]

VM のサイズは、 UI で選択した VM ファミリーに含まれます。ドロップダウンから変更できます。（例 _ 標準 DV3 ファミリー _ Azure 内）

image:VMResource1.png[""]



=== ユーザ数に基づいた拡張


NOTE: 下の関数は、「アクティブユーザー」または「ユーザー数」のどちらでも同じ動作をします。ユーザー数とは 'VDS デスクトップでアクティブ化されたすべてのユーザーの数のことですアクティブユーザーは、過去 2 週間のユーザーセッションデータに基づいて計算された変数です。

ユーザに基づいて計算する場合、セッションホスト VM のサイズ（および数）は、定義されている RAM および CPU の要件に基づいて計算されます。管理者は、 RAM の GB 、ユーザあたりの vCPU コア数、および変数に対応しないリソースを追加で定義できます。

次のスクリーンショットでは、各ユーザに 2GB の RAM と 1/2 の vCPU コアが割り当てられています。さらに、サーバは 2 vCPU コアと 8 GB RAM から始まります。

image:VMResource3.png[""]

また、 VM が到達できる最大サイズを定義することもできます。この条件に達すると、 VM セッションホストを追加することで環境をスケールアウトできます。

次のスクリーンショットでは、各 VM の最大コア数は 32GB 、 vCPU × 8 個です。

image:VMResource4.png[""]

VDS では、これらすべての変数を定義して、適切なサイズとセッションホスト VM の数を計算できるため、ユーザの追加や削除に合わせて適切なリソース割り当てを管理するプロセスが大幅に簡易化されます。



=== サーバの負荷に基づいてスケーリングします

サーバの負荷に基づいて計算する場合、セッションホスト VM のサイズ（および数）は、前の 2 週間の VDS で観測された平均 CPU / RAM 使用率に基づいて計算されます。

最大しきい値を超えた場合 'VDS はサイズを増やすか ' または平均使用量を範囲内に戻すために数量を増やします

ユーザベースの拡張と同様に、 VM ファミリーと最大 VM サイズを定義できます。

image:VMResource6.png[""]



== その他のアクティブなリソース

ワークロードスケジューリングでは、 Wake on Demand 機能を起動して他のプラットフォームタスクを容易にするために必要な CWMGR1 などのプラットフォームサーバは制御されません。また、通常の環境動作では 24 時間 365 日稼働する必要があります。

環境全体を非アクティブ化することでさらに削減できますが、非本番環境でのみ推奨されます。VDS の導入セクションで実行できる手動の操作です。環境を正常な状態に戻すには、同じページで手動の手順も必要です。

image:Stop_Deployment.png[""]
image:Start_deployment.png[""]
